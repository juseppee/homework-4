<div class="myWrapper" align="center" markdown="1">

# :books: Задание №2

</div>

## :mortar_board: Формулировка задания

Заводы производственной фирмы (производство офисных кресел) расположены в городах Омск, Новосибирск, Томск. Центры распределения расположены в городах Нижний Новгород, Пермь, Краснодар. Объемы производства и величина спроса в пунктах представлены в Приложении.
1. Одно изделие имеет вес 3 кг. и объем 0,8 м3. Стоимость перевозки рассчитайте с помощью онлайн-калькулятора http://www.jde.ru/calc.
2. Составьте экономико-математическую модель задачи.
3. Найдите оптимальное распределение поставок и минимальные затраты на перевозку одним любым методом
  - Венгерский метод
  - Метод потенциалов
  - Дельта-метод

При нахождении опорных планов использовать любые два из четырех
1. Метод северо-западного угла
2. Метод минимальной стоимости
3. Метод двойного предпочтения
4. Метод аппроксимации Фогеля

## :scroll: Входные данные

| Поставщики\\Потребители | Нижний Новгород | Пермь | Краснодар | Поставок |
| - | - | - | - | - | 
| Омск | 3637 | 3793 | 4509 | 1000 |
| Новосибирск | 3043 | 3165 | 3714 | 1200 |
| Томск | 4386 | 4711 | 5607 | 1600 |
| Потребления | 1600 | 1000 | 1200 | 3800 |

## :computer: Сборка и запуск

Для запуска потребуется `java` и `gradle` к ней. Это уж не буду расписывать как поставить

```shell
git clone https://github.com/zalimannard/homework-4
cd homework-4/simulation-of-operations/lab-2
gradle build
java -jar build/libs/hw4-soo-lab2.jar transportation-cost.csv
```

## :movie_camera: Ход работы

### 1. Считывание данных, занесение их в табличку

Здесь они хранятся в файле `.csv`, передаваемом программе как аргумент, в формате, описанном в разделе [Входные данные](#входные-данные), только без нижнего правого значения. Внутри программы хранятся в специальном классе Table

### 2. Проверка на соответствие спроса и предложения

Эта программа не умеет подгонять спрос и предложение и при их несоответствии просто пишет сообщение, что таблица несбалансирована и выключается. Можно это модернизировать, чтобы в случае, когда предложения больше, чем спроса, оставшуюся часть себе забирал фиктивный потребитель

### 3. Получение первого опорного решения

#### Методом северо-западного угла

Начинаем с верхнего левого угла, вычитаем из поставщка и потребителя минимум из них двоих. Один из них гарантировано будет иметь 0 в своём поле и мы сможем перейти на следующую ступеньку. Если спрос заканчивается быстрее, то меняем позицию по горизонтали. Предложение - по вертикали. Они могут закончиться и вместе, тогда переходим по диагонали вправо-вниз

В этой задаче будет иметь такой вид

| Поставщики\\Потребители | Нижний Новгород | Пермь | Краснодар | Поставок |
| - | - | - | - | - | 
| Омск | 1000 | 0 | 0 | 1000 |
| Новосибирск | 600 | 600 | 0 | 1200 |
| Томск | 0 | 400 | 1200 | 1600 |
| Потребления | 1600 | 1000 | 1200 | 3800 |

#### Методом наименьшей стоимости

В этой задаче будет иметь такой вид

| Поставщики\\Потребители | Нижний Новгород | Пермь | Краснодар | Поставок |
| - | - | - | - | - | 
| Омск | 400 | 600 | 0 | 1000 |
| Новосибирск | 1200 | 0 | 0 | 1200 |
| Томск | 0 | 400 | 1200 | 1600 |
| Потребления | 1600 | 1000 | 1200 | 3800 |

Пока не закончатся все потребности, ищем ячейку с минимальной стоимостью за единицу, чтобы максимально провезти товар через неё. Отправляем тоже сразу по максимуму. Когда с одним ценников отработали - переходим к следующему, а этот отбрасываем

### 4. Проверяем решение на оптимальность

Если оптимально, заканчиваем выполнение. Нет - продолжаем выполнение

### 4.1. Вычисляем потенциалы

Если в первом опорном решении занятых ячеек (входящих в базис) меньше, чем `поставщики + потребители - 1`, то нужно добавить нули до нужного количества, но следя за тем, чтобы не образовывались **циклы**

> **Циклом** называется такая последовательность клеток таблицы транспортной задачи, в которой две и только две соседние клетки расположены в одном столбце или строке таблицы, причем последняя клетка находится в той же строке или столб-це, что и первая. Они могут быть любых форм, главное, чтобы выполнялись условия:
> 1. Цикл должен быть замкнутый
> 2. Поворачивать можно только на загруженных клетках.

Для того, чтобы найти потенциалы, нужно задать какой-нибудь крайней ячейке (потенциалу) значение 0. Пусть это будет первый поставщик. Остальные должны заполняться по правилу `C = A + B`, где `C` - цена в ячейке, входящей в базис, `A` - потенциал у поставщика, `B` - потенциал у потребителя

В итоге должна получиться табличка типа такой

| Поставщики\\Потребители | Нижний Новгород | Пермь | Краснодар | Поставок |
| - | - | - | - | - | 
| Омск |   |   |   | 0 |
| Новосибирск |   |   |   | -594 |
| Томск |   |   |   | 592 |
| Потребления | 3637 | 3759 | 4655 |   |

### 4.2. Получаем таблицу с дельтами

Она нам потребуется чтобы узнать оптимальность плана и, если он не оптимальный, то с какой ячейки начать улучшать план. Её состав - ячейки не входящие в базис. Значения вычисляются по формуле `C = A + B - D`, где `C` - искомая дельта, `A` - потенциал у поставщика, `B` - потенциал у потребителя, `D` - цена в ячейке. И итоге получается какая-то такая табличка 

| Поставщики\\Потребители | Нижний Новгород | Пермь | Краснодар | Поставок |
| - | - | - | - | - | 
| Омск |   | -34 | 146 |  |
| Новосибирск |  |  | 347 |  |
| Томск | 203 |  |  |  |
| Потребления |  |  |  |   |

### 4.3. Сама проверка 

Если в табличке с дельтами есть значения >0, то план не оптимальный. И оптимизацию стоит начать с самого большого положительного значения.

Если все значения <0, то план оптимальный, работа алгоритма заканчивается

### 5. Улучшаем план

Строим цикл с началом в ячейке с самой большей дельтой. Он получится чётной длины, поэтому после построения ячкйки можно поочерёдно отметить знаками `+ - + - + -` Ищем минимальное значение из тех, что отмечены знаком `-` и вычитаем его из всех чисел, отмеченных знаком `-` и прибавляем ко всем числам, отмеченным знаком `+`. Это наше новое решение

Переходим к пункту [4](#4-проверяем-решение-на-оптимальность)

### Результат

15267400 рублей

Итоговый план:

| Поставщики\\Потребители | Нижний Новгород | Пермь | Краснодар | Поставок |
| - | - | - | - | - | 
| Омск |  | 1000 |  | 1000 |
| Новосибирск |  |  | 1200 | 1200 |
| Томск | 1600 |  |  | 1600 |
| Потребления | 1600 | 1000 | 1200 | 3800 |

## :bookmark: Примечание

- Мне показалось слишком неоправданно сложным писать честную реализацию нахождения всех циклов, это задача может превосходить по сложности изначальную. Поэтому эта программа обрабатывает только квадратные и формата 3x3 в виде буквы S, потому что при моих условиях использовались они

